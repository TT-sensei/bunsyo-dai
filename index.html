<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ ã€œç«‹å¼ãƒã‚¹ã‚¿ãƒ¼ã¸ã®é“ã€œ</title>
    <style>
        /* ===================================
           CSS: å†’é™ºã®ä¸–ç•Œè¦³ã‚’ä½œã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³
        ==================================== */
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #e8f5e9; /* æ£®ã®ã‚ˆã†ãªè–„ã„ç·‘ */
            color: #333;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆç”»é¢ä¸Šéƒ¨ï¼‰ */
        .status-bar {
            background-color: #3e2723; /* æœ¨ã®å¹¹ã®ã‚ˆã†ãªæ·±ã„ã“ã’èŒ¶è‰² */
            color: #fff;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .title-text { color: #ffd54f; font-size: 0.9em; margin-left: 5px; }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .nav-menu { background-color: #5d4037; padding: 10px; }
        .nav-btn { background-color: #8d6e63; color: white; border: 2px solid #3e2723; }
        .nav-btn.active { background-color: #ffb300; color: #3e2723; border-color: #fff; }

        /* ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆå®ã®åœ°å›³ãƒ»å¤æ–‡æ›¸é¢¨ï¼‰ */
        #main-content {
            background-color: #fff8e1; /* å¤ã³ãŸç¾Šçš®ç´™ã®è‰² */
            margin: 20px auto;
            padding: 30px 20px;
            max-width: 650px;
            border-radius: 10px;
            border: 5px solid #8d6e63; /* æœ¨ã®æ çµ„ã¿ */
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            min-height: 400px;
        }

        /* ãƒœã‚¿ãƒ³é¡ï¼ˆç«‹ä½“çš„ã§æŠ¼ã—ã‚„ã™ã„ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
        button {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 12px 18px;
            margin: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        button:active { transform: translateY(5px); box-shadow: 0 0 0 rgba(0,0,0,0); }
        button:disabled { background-color: #ccc !important; box-shadow: none; transform: none; cursor: not-allowed; }

        .cat-btn { background-color: #4caf50; color: white; width: 45%; font-size: 1rem; }
        .btn-hint { background-color: #ff9800; color: white; }
        .btn-auto { background-color: #2196f3; color: white; width: 80%; margin-top: 20px; }
        .btn-manual { background-color: #e91e63; color: white; width: 80%; }
        .btn-gacha-play { background-color: #e53935; color: white; font-size: 1.3rem; padding: 15px 30px; }

        /* å…¥åŠ›æ¬„ã¨ãƒ’ãƒ³ãƒˆæ–‡å­— */
        input[type="text"], input[type="number"] {
            font-size: 1.5rem;
            padding: 10px;
            width: 70%;
            margin: 10px 0;
            border: 3px solid #8d6e63;
            border-radius: 8px;
            text-align: center;
            background-color: #fafafa;
        }
        .hint-target { font-weight: bold; transition: color 0.3s, background-color 0.3s; }
        .hint-active { color: red; background-color: yellow; padding: 0 5px; border-radius: 5px; }

        /* ã‚¬ãƒãƒ£ã¨å›³é‘‘ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .gacha-display-area { font-size: 5rem; margin: 20px 0; min-height: 120px; }
        .gacha-name { font-size: 1.5rem; font-weight: bold; color: #d84315; }
        .collection-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px; }
        .collection-item { font-size: 3rem; background: #fff; border: 2px dashed #8d6e63; border-radius: 10px; padding: 10px; }
        .collection-unknown { color: #ccc; font-size: 2rem; display: flex; align-items: center; justify-content: center; height: 100%; }

        .hidden { display: none !important; }
        .message-area { font-size: 1.3em; font-weight: bold; margin-top: 15px; min-height: 1.5em; }
    </style>
</head>
<body>

    <header id="status-bar" class="status-bar">
        <div class="status-item">
            ğŸŒŸ ãƒ¬ãƒ™ãƒ«: <span id="disp-level">1</span> 
            <span id="disp-title" class="title-text">ï¼ˆã¿ãªã‚‰ã„å†’é™ºå®¶ï¼‰</span>
        </div>
        <div class="status-item">âš”ï¸ EXP: <span id="disp-exp">0</span> / 5</div>
        <div class="status-item">ğŸª™ ã‚³ã‚¤ãƒ³: <span id="disp-coin">10</span></div> </header>

    <nav id="main-nav" class="nav-menu">
        <button id="nav-study" class="nav-btn active" onclick="switchScreen('study')">ğŸ“– ãŒãã—ã‚…ã†</button>
        <button id="nav-gacha" class="nav-btn" onclick="switchScreen('gacha')">ğŸ ã‚¬ãƒãƒ£</button>
        <button id="nav-collection" class="nav-btn" onclick="switchScreen('collection')">ğŸ“˜ ãšã‹ã‚“</button>
    </nav>

    <main id="main-content">

        <section id="screen-study" class="screen">
            <div class="category-selector">
                <button class="cat-btn" onclick="playSound('click')">ãŸã—ã–ã‚“ (1ğŸª™)</button>
                <button class="cat-btn" onclick="playSound('click')">ã²ãã–ã‚“ (2ğŸª™)</button>
                <button class="cat-btn" onclick="playSound('click')">ã‹ã‘ã–ã‚“ (3ğŸª™)</button>
                <button class="cat-btn" onclick="playSound('click')">ã‚ã‚Šã–ã‚“ (4ğŸª™)</button>
                <button class="cat-btn" onclick="playSound('click')">ãƒŸãƒƒã‚¯ã‚¹ ãƒ¬ãƒ™ãƒ«1 (2ğŸª™)</button>
                <button class="cat-btn" onclick="playSound('click')">ãƒŸãƒƒã‚¯ã‚¹ ãƒ¬ãƒ™ãƒ«3 (5ğŸª™)</button>
            </div>

            <hr style="border:1px dashed #8d6e63; margin: 20px 0;">

            <div class="question-box">
                <p id="question-text" style="font-size: 1.2rem; text-align: left; padding: 0 20px;">
                    ã€ãƒ†ã‚¹ãƒˆå•é¡Œã€‘<br>ã‚Šã‚“ã”ãŒ 5ã“ ã‚ã‚Šã¾ã™ã€‚ã¿ã‹ã‚“ã‚’ 3ã“ ã‹ã„ã¾ã—ãŸã€‚<br>
                    <span id="hint-target" class="hint-target">ã‚ã‚ã›ã¦</span> ã„ãã¤ã« ãªã‚Šã¾ã™ã‹ã€‚
                </p>
                <button id="btn-hint" class="btn-hint" onclick="showHint()">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</button>
            </div>

            <div class="input-box">
                <div class="input-group">
                    <label for="input-equation">ã—ãï¼š</label>
                    <input type="text" id="input-equation" placeholder="ä¾‹: 5+3" autocomplete="off">
                </div>
                <div class="input-group">
                    <label for="input-answer">ã“ãŸãˆï¼š</label>
                    <input type="number" id="input-answer" placeholder="ãŠã¾ã‹ã›ã®æ™‚ã¯ç©ºã§OK" autocomplete="off">
                </div>
            </div>

            <div class="action-box">
                <button id="btn-auto-calc" class="btn-action btn-auto" onclick="checkAnswer('auto')">
                    âš”ï¸ ã‘ã„ã•ã‚“ã‚’ãŠã¾ã‹ã›ï¼<br><small>ï¼ˆå¼ã ã‘ã‚ã£ã¦ã„ã‚Œã°OKï¼‰</small>
                </button>
                <button id="btn-manual-calc" class="btn-action btn-manual" onclick="checkAnswer('manual')">
                    ğŸ’ª ã˜ã¶ã‚“ã§ã‘ã„ã•ã‚“ã—ãŸï¼<br><small>ï¼ˆæ­£è§£ã™ã‚‹ã¨ ãƒœãƒ¼ãƒŠã‚¹ +1ğŸª™ï¼‰</small>
                </button>
            </div>

            <div id="result-message" class="message-area"></div>
        </section>


        <section id="screen-gacha" class="screen hidden">
            <h2>ãŠå®ã‚¬ãƒãƒ£</h2>
            <p>10ã‚³ã‚¤ãƒ³ã§ 1å› ã‚¬ãƒãƒ£ãŒã²ã‘ã‚‹ã‚ˆï¼</p>
            
            <div class="gacha-display-area">
                <div id="gacha-result-emoji" class="gacha-emoji">â“</div>
                <div id="gacha-result-name" class="gacha-name">ãªã«ãŒã§ã‚‹ã‹ãªï¼Ÿ</div>
            </div>

            <button id="btn-play-gacha" class="btn-gacha-play" onclick="playGacha()">ã‚¬ãƒãƒ£ã‚’ã¾ã‚ã™ï¼ˆ10ğŸª™ï¼‰</button>
            <div id="gacha-message" class="message-area"></div>
        </section>


        <section id="screen-collection" class="screen hidden">
            <h2>ã¼ã†ã‘ã‚“ã® ãã‚ãï¼ˆãšã‹ã‚“ï¼‰</h2>
            <p>ã‚ã¤ã‚ãŸ ãŠå®ã‚„ ç”Ÿãç‰©ãŸã¡</p>
            <div id="collection-grid" class="collection-grid">
                </div>
        </section>

    </main>

    <script>
        /* ===================================
           JS: ãƒ–ãƒ©ã‚¦ã‚¶ã§éŸ³ã‚’é³´ã‚‰ã™ä»•çµ„ã¿
        ==================================== */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'click') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'correct') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); 
                oscillator.frequency.setValueAtTime(1108, audioCtx.currentTime + 0.1); 
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'wrong') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.2);
            } else if (type === 'gacha') {
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(880, audioCtx.currentTime + 0.5);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.5);
            }
        }

        /* ===================================
           JS: ã‚²ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ã‚¸ãƒƒã‚¯
        ==================================== */
        // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®ä»£ã‚ã‚Šï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        let level = 1;
        let exp = 0;
        let coin = 10; // ã‚¬ãƒãƒ£ãƒ†ã‚¹ãƒˆç”¨ã«æœ€åˆã‹ã‚‰10æš
        let myCollectionIds = []; // ã‚²ãƒƒãƒˆã—ãŸã‚¬ãƒãƒ£ã®ID

        // ç§°å·ã®ãƒªã‚¹ãƒˆ
        const titles = [
            { lv: 1, name: "ã¿ãªã‚‰ã„å†’é™ºå®¶" },
            { lv: 2, name: "ã‹ã‘ã ã—ã®æ—…äºº" },
            { lv: 3, name: "ã„ã£ã±ã—ã®æˆ¦å£«" },
            { lv: 4, name: "ãƒ™ãƒ†ãƒ©ãƒ³æ¢ç´¢è€…" },
            { lv: 5, name: "ä¼èª¬ã®å‹‡è€…" }
        ];

        // ãƒ†ã‚¹ãƒˆç”¨ã®å•é¡Œãƒ‡ãƒ¼ã‚¿
        const testQuestion = { equation: "5+3", answer: "8", reward: 1 };

        // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¬ãƒãƒ£æ™¯å“ãƒ‡ãƒ¼ã‚¿
        const gachaItems = [
            { id: 1, emoji: "ğŸ¸", name: "ã‚¹ãƒ©ã‚¤ãƒ ã‚¬ã‚¨ãƒ«" },
            { id: 2, emoji: "ğŸª™", name: "å¤ã³ãŸé‡‘è²¨" },
            { id: 3, emoji: "ğŸ—¡ï¸", name: "ã©ã†ã®ã¤ã‚‹ã" },
            { id: 4, emoji: "ğŸ¦…", name: "å¤§ç©ºã®ãƒ¯ã‚·" },
            { id: 5, emoji: "ğŸ‰", name: "ä¼èª¬ã®ãƒ‰ãƒ©ã‚´ãƒ³" }
        ];

        // --- ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ---
        function switchScreen(screenName) {
            playSound('click');
            // ã™ã¹ã¦ã®ç”»é¢ã‚’éš ã™
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // é¸ã‚“ã ç”»é¢ã ã‘è¡¨ç¤ºã™ã‚‹
            document.getElementById(`screen-${screenName}`).classList.remove('hidden');
            document.getElementById(`nav-${screenName}`).classList.add('active');

            // å›³é‘‘ç”»é¢ã‚’é–‹ã„ãŸæ™‚ã¯å›³é‘‘ã‚’æ›´æ–°
            if(screenName === 'collection') updateCollectionGrid();
        }

        // --- ãƒ’ãƒ³ãƒˆæ©Ÿèƒ½ ---
        function showHint() {
            playSound('click');
            document.getElementById("hint-target").classList.add("hint-active");
        }

        // --- ç­”ãˆåˆã‚ã›æ©Ÿèƒ½ ---
        function checkAnswer(mode) {
            let inputEq = document.getElementById("input-equation").value.replace(/\s+/g, "");
            let inputAns = document.getElementById("input-answer").value.replace(/\s+/g, "");
            let msgBox = document.getElementById("result-message");

            // å¼ãŒåˆã£ã¦ã„ã‚‹ã‹
            let isEqCorrect = (inputEq === testQuestion.equation);
            // ç­”ãˆã‚‚åˆã£ã¦ã„ã‚‹ã‹
            let isAnsCorrect = (inputAns === testQuestion.answer);

            if (mode === 'auto') {
                if (isEqCorrect) {
                    processCorrect("ãŠã¾ã‹ã›å¤§æ­£è§£ï¼ ç­”ãˆã¯ã€Œ" + testQuestion.answer + "ã€ã ã‚ˆï¼", testQuestion.reward);
                } else {
                    processWrong("å¼ãŒã¡ãŒã†ã¿ãŸã„â€¦ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã‚ˆã†ï¼");
                }
            } else if (mode === 'manual') {
                if (isEqCorrect && isAnsCorrect) {
                    // è‡ªåŠ›è¨ˆç®—ãƒœãƒ¼ãƒŠã‚¹ +1 ã‚³ã‚¤ãƒ³ï¼
                    processCorrect("ã˜ã‚Šãã§å¤§æ­£è§£ï¼ ã™ã”ã„ï¼ ãƒœãƒ¼ãƒŠã‚¹+1ğŸª™", testQuestion.reward + 1);
                } else if (isEqCorrect && !isAnsCorrect) {
                    processWrong("å¼ã¯åˆã£ã¦ã‚‹ã‘ã©ã€è¨ˆç®—ãŒã¡ãŒã†ã‹ã‚‚ï¼Ÿ");
                } else {
                    processWrong("å¼ã‚‚ç­”ãˆã‚‚ã¡ãŒã†ã¿ãŸã„â€¦ã€‚");
                }
            }
        }

        // --- æ­£è§£ã—ãŸã¨ãã®å‡¦ç† ---
        function processCorrect(msg, getCoin) {
            playSound('correct');
            document.getElementById("result-message").innerText = msg;
            document.getElementById("result-message").style.color = "#2e7d32";
            
            coin += getCoin;
            exp += 1;

            if (exp >= 5) {
                level += 1;
                exp = 0;
                coin += 5; // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒœãƒ¼ãƒŠã‚¹
                alert("ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ï¼ ãƒ¬ãƒ™ãƒ« " + level + " ã«ãªã£ãŸï¼\nãƒœãƒ¼ãƒŠã‚¹ 5ğŸª™ ã‚²ãƒƒãƒˆï¼");
            }
            updateStatus();
        }

        // --- é–“é•ãˆãŸã¨ãã®å‡¦ç† ---
        function processWrong(msg) {
            playSound('wrong');
            document.getElementById("result-message").innerText = msg;
            document.getElementById("result-message").style.color = "#d32f2f";
        }

        // --- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° ---
        function updateStatus() {
            document.getElementById("disp-level").innerText = level;
            document.getElementById("disp-exp").innerText = exp;
            document.getElementById("disp-coin").innerText = coin;

            // ç§°å·ã®æ›´æ–°
            let currentTitle = titles[0].name;
            for(let i=0; i<titles.length; i++){
                if(level >= titles[i].lv) currentTitle = titles[i].name;
            }
            document.getElementById("disp-title").innerText = "ï¼ˆ" + currentTitle + "ï¼‰";
        }

        // --- ã‚¬ãƒãƒ£æ©Ÿèƒ½ ---
        function playGacha() {
            if (coin < 10) {
                playSound('wrong');
                document.getElementById("gacha-message").innerText = "ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã‚ˆï¼(ã‚ã¨ " + (10 - coin) + "ğŸª™)";
                document.getElementById("gacha-message").style.color = "#d32f2f";
                return;
            }

            playSound('gacha');
            coin -= 10;
            updateStatus();

            // ãƒ©ãƒ³ãƒ€ãƒ ã§æ™¯å“ã‚’é¸ã¶
            let randomIdx = Math.floor(Math.random() * gachaItems.length);
            let item = gachaItems[randomIdx];

            // ç”»é¢ã«è¡¨ç¤º
            document.getElementById("gacha-result-emoji").innerText = item.emoji;
            document.getElementById("gacha-result-name").innerText = item.name;
            document.getElementById("gacha-message").innerText = "ã€Œ" + item.name + "ã€ã‚’ã‚²ãƒƒãƒˆã—ãŸï¼";
            document.getElementById("gacha-message").style.color = "#2e7d32";

            // å›³é‘‘ã«ç™»éŒ²ï¼ˆã¾ã æŒã£ã¦ã„ãªã‘ã‚Œã°ï¼‰
            if (!myCollectionIds.includes(item.id)) {
                myCollectionIds.push(item.id);
            }
        }

        // --- å›³é‘‘ï¼ˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã®è¡¨ç¤ºæ›´æ–° ---
        function updateCollectionGrid() {
            let grid = document.getElementById("collection-grid");
            grid.innerHTML = ""; // ä¸€åº¦ç©ºã«ã™ã‚‹

            // ã‚¬ãƒãƒ£ã®å…¨ç¨®é¡ã‚’å›³é‘‘ã«ä¸¦ã¹ã‚‹
            gachaItems.forEach(item => {
                let div = document.createElement("div");
                div.className = "collection-item";
                
                if (myCollectionIds.includes(item.id)) {
                    // æŒã£ã¦ã„ã‚‹å ´åˆ
                    div.innerText = item.emoji;
                } else {
                    // æŒã£ã¦ã„ãªã„å ´åˆ
                    div.innerHTML = "<span class='collection-unknown'>ï¼Ÿ</span>";
                }
                grid.appendChild(div);
            });
        }

        // èµ·å‹•æ™‚ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åæ˜ 
        updateStatus();
    </script>
</body>
</html>
