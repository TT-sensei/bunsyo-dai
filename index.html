<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†’é™ºã®æ‹ ç‚¹ - ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ</title>
    <style>
        /* ===================================
           å…¨ä½“ãƒ‡ã‚¶ã‚¤ãƒ³
        ==================================== */
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #e8f5e9; color: #333; margin: 0; padding-bottom: 50px; text-align: center; }
        .app-title { color: #2e7d32; font-size: 2rem; margin: 15px 0; text-shadow: 2px 2px 0px #fff; }
        .status-bar { background-color: #3e2723; color: #fff; padding: 15px; display: flex; justify-content: space-around; font-size: 1.2rem; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.3); border-radius: 10px; margin: 0 10px; }
        .title-text { color: #ffd54f; font-size: 0.9em; margin-left: 5px; }
        #main-content { margin: 20px auto; max-width: 650px; padding: 0 10px; }
        
        button { font-weight: bold; padding: 12px 18px; margin: 8px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 5px 0 rgba(0,0,0,0.2); transition: transform 0.1s; }
        button:active { transform: translateY(5px); box-shadow: 0 0 0 rgba(0,0,0,0); }
        .hidden { display: none !important; }

        /* å­¦å¹´é¸æŠã‚¨ãƒªã‚¢ */
        .grade-section { background-color: #fff8e1; padding: 20px; border-radius: 10px; border: 4px solid #8d6e63; margin-bottom: 30px; }
        .grade-btn { font-size: 1.4rem; width: 90%; padding: 15px; margin: 10px auto; display: block; color: white; border: 2px solid rgba(255,255,255,0.5); }
        .grade-1 { background-color: #66bb6a; } /* ğŸŒ± 1å¹´ */
        .grade-2 { background-color: #43a047; } /* ğŸŒ¿ 2å¹´ */
        .grade-3 { background-color: #2e7d32; } /* ğŸŒ³ 3å¹´ */

        /* ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆå±•é–‹æ™‚ï¼‰ */
        .sub-menu { background-color: rgba(255,255,255,0.8); border-radius: 8px; padding: 15px; margin: 10px auto; width: 85%; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); border: 2px dashed #8d6e63; }
        .sub-menu h3 { margin-top: 0; color: #3e2723; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        
        .btn-story { background-color: #fbc02d; color: #3e2723; width: 90%; font-size: 1.2rem; }
        .btn-cave { background-color: #424242; color: #ffeb3b; width: 90%; font-size: 1.1rem; border: 2px dashed #ffeb3b; }
        
        .training-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 15px; }
        .btn-train { background-color: #0288d1; color: white; font-size: 1rem; padding: 10px; margin: 0; }

        /* ã‚¬ãƒãƒ£ãƒ»å›³é‘‘ã‚¨ãƒªã‚¢ */
        .gacha-section { background-color: #fce4ec; padding: 20px; border-radius: 10px; border: 4px dashed #f06292; margin-bottom: 30px; }
        .btn-gacha-play { background-color: #e53935; color: white; font-size: 1.3rem; padding: 15px 30px; }
        .gacha-display-area { font-size: 4rem; margin: 10px 0; min-height: 80px; }
        
        .adventure-note { background-color: #fff3e0; padding: 20px; border-radius: 5px 15px 15px 5px; border-left: 15px solid #795548; border-top: 2px solid #8d6e63; border-right: 2px solid #8d6e63; border-bottom: 2px solid #8d6e63; box-shadow: 5px 5px 15px rgba(0,0,0,0.2); }
        .collection-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .collection-item { font-size: 2.5rem; background: #fff; border: 1px solid #d7ccc8; border-radius: 5px; padding: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
        .collection-unknown { color: #e0e0e0; font-size: 2rem; display: flex; align-items: center; justify-content: center; height: 100%; }
        .message-area { font-size: 1.2em; font-weight: bold; margin-top: 10px; min-height: 1.5em; }
    </style>
</head>
<body>

    <h1 class="app-title">âš”ï¸ ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ âš”ï¸</h1>

    <header id="status-bar" class="status-bar">
        <div>ğŸŒŸ Lv: <span id="disp-level">1</span> <span id="disp-title" class="title-text">ï¼ˆã¿ãªã‚‰ã„ï¼‰</span></div>
        <div>âš”ï¸ EXP: <span id="disp-exp">0</span>/5</div>
        <div>ğŸª™ <span id="disp-coin">10</span>æš</div>
    </header>

    <main id="main-content">

        <section class="grade-section">
            <h2 style="color: #3e2723; margin-top: 0;">ğŸ—ºï¸ ã©ã®ãƒ¬ãƒ™ãƒ«ã« ã¡ã‚‡ã†ã›ã‚“ã™ã‚‹ï¼Ÿ</h2>
            
            <button class="grade-btn grade-1" onclick="toggleMenu('menu-grade1')">ğŸŒ± 1å¹´ç”Ÿï¼ˆãŸã—ã–ã‚“ãƒ»ã²ãã–ã‚“ï¼‰</button>
            <div id="menu-grade1" class="sub-menu hidden">
                <h3>ğŸŒ± 1å¹´ç”Ÿã®ã¼ã†ã‘ã‚“</h3>
                <p style="font-size:0.8rem; color:#666;">ã„ã‚ã‚“ãªå•é¡ŒãŒã¾ã–ã£ã¦å‡ºã¦ãã‚‹ãï¼</p>
                <button class="btn-story" onclick="goToQuest('quest.html?grade=1&mode=story')">âš”ï¸ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆ (åŸºæœ¬)</button>
                
                <h4 style="margin: 15px 0 5px 0; color:#0288d1;">ğŸ¯ è¨“ç·´å ´ï¼ˆãƒ‹ã‚¬ãƒ†ã¨ã£ãã‚“ï¼‰</h4>
                <div class="training-grid">
                    <button class="btn-train" onclick="goToQuest('quest.html?grade=1&mode=train_add')">ï¼‹ ãŸã—ã–ã‚“</button>
                    <button class="btn-train" onclick="goToQuest('quest.html?grade=1&mode=train_sub')">ï¼ ã²ãã–ã‚“</button>
                </div>
                
                <h4 style="margin: 15px 0 5px 0; color:#424242;">ğŸ•³ ä¿®è¡Œã®æ´ãã¤ï¼ˆã¾ã¡ãŒã„ç›´ã—ï¼‰</h4>
                <button class="btn-cave" onclick="goToQuest('quest.html?grade=1&mode=cave')">ğŸ•³ ã¾ã¡ãŒãˆãŸå•é¡Œã‚’ã‚„ã‚ŠãªãŠã™</button>
            </div>

            <button class="grade-btn grade-2" onclick="toggleMenu('menu-grade2')">ğŸŒ¿ 2å¹´ç”Ÿï¼ˆï¼‹ ã‹ã‘ã–ã‚“ï¼‰</button>
            <div id="menu-grade2" class="sub-menu hidden">
                <h3>ğŸŒ¿ 2å¹´ç”Ÿã®ã¼ã†ã‘ã‚“</h3>
                <button class="btn-story" onclick="goToQuest('quest.html?grade=2&mode=story')">âš”ï¸ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆ (åŸºæœ¬)</button>
                <h4 style="margin: 15px 0 5px 0; color:#0288d1;">ğŸ¯ è¨“ç·´å ´ï¼ˆãƒ‹ã‚¬ãƒ†ã¨ã£ãã‚“ï¼‰</h4>
                <div class="training-grid">
                    <button class="btn-train" onclick="goToQuest('quest.html?grade=2&mode=train_add')">ï¼‹ ãŸã—ã–ã‚“</button>
                    <button class="btn-train" onclick="goToQuest('quest.html?grade=2&mode=train_sub')">ï¼ ã²ãã–ã‚“</button>
                    <button class="btn-train" style="grid-column: span 2;" onclick="goToQuest('quest.html?grade=2&mode=train_mul')">Ã— ã‹ã‘ã–ã‚“</button>
                </div>
                <button class="btn-cave" onclick="goToQuest('quest.html?grade=2&mode=cave')">ğŸ•³ ä¿®è¡Œã®æ´ãã¤ã¸</button>
            </div>

            <button class="grade-btn grade-3" onclick="toggleMenu('menu-grade3')">ğŸŒ³ 3å¹´ç”Ÿï¼ˆï¼‹ ã‚ã‚Šã–ã‚“ï¼‰</button>
            <div id="menu-grade3" class="sub-menu hidden">
                <h3>ğŸŒ³ 3å¹´ç”Ÿã®ã¼ã†ã‘ã‚“</h3>
                <button class="btn-story" onclick="goToQuest('quest.html?grade=3&mode=story')">âš”ï¸ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆ (åŸºæœ¬)</button>
                <h4 style="margin: 15px 0 5px 0; color:#0288d1;">ğŸ¯ è¨“ç·´å ´ï¼ˆãƒ‹ã‚¬ãƒ†ã¨ã£ãã‚“ï¼‰</h4>
                <div class="training-grid">
                    <button class="btn-train" onclick="goToQuest('quest.html?grade=3&mode=train_addsub')">ï¼‹ï¼ ãŸã—ãƒ»ã²ã</button>
                    <button class="btn-train" onclick="goToQuest('quest.html?grade=3&mode=train_mul')">Ã— ã‹ã‘ã–ã‚“</button>
                    <button class="btn-train" style="grid-column: span 2; background-color: #7b1fa2;" onclick="goToQuest('quest.html?grade=3&mode=train_div')">Ã· ã‚ã‚Šã–ã‚“</button>
                </div>
                <button class="btn-cave" onclick="goToQuest('quest.html?grade=3&mode=cave')">ğŸ•³ ä¿®è¡Œã®æ´ãã¤ã¸</button>
            </div>

        </section>

        <section class="gacha-section">
            <h2 style="margin-top: 0; color: #c2185b;">ğŸ ãƒˆãƒ¬ã‚¸ãƒ£ãƒ¼ã‚¬ãƒãƒ£</h2>
            <p style="font-size:0.9rem; color:#666;">ã©ã‚Šã‚‡ãã®çµæ™¶ï¼ˆã‚³ã‚¤ãƒ³ï¼‰ã§ãŠå®ã‚’ã‚²ãƒƒãƒˆï¼</p>
            <div class="gacha-display-area"><div id="gacha-result-emoji">â“</div></div>
            <button class="btn-gacha-play" onclick="playGacha()">ã‚¬ãƒãƒ£ã‚’ã¾ã‚ã™ï¼ˆ10ğŸª™ï¼‰</button>
            <div id="gacha-message" class="message-area"></div>
        </section>

        <section class="adventure-note">
            <h2 style="margin-top: 0; color: #5d4037; border-bottom: 2px dotted #8d6e63; padding-bottom: 10px;">ğŸ“– å†’é™ºãƒãƒ¼ãƒˆ</h2>
            <p style="font-size: 0.9rem; color: #757575;">ã‚ã¤ã‚ãŸ ãŠå®ã‚„ ç”Ÿãç‰©ãŸã¡ãŒ ãã‚ãã•ã‚Œã‚‹ãï¼</p>
            <div id="collection-grid" class="collection-grid"></div>
        </section>

    </main>

    <script>
        // --- éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ  ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if (type === 'click') { osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.1); }
            else if (type === 'gacha') { osc.type = 'square'; osc.frequency.setValueAtTime(440, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(880, audioCtx.currentTime + 0.5); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.5); }
        }

        // --- ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
        let level = parseInt(localStorage.getItem('saved_level')) || 1;
        let exp = parseInt(localStorage.getItem('saved_exp')) || 0;
        let coin = parseInt(localStorage.getItem('saved_coin')) || 10;
        let myCollectionIds = JSON.parse(localStorage.getItem('saved_collection')) || [];
        const titles = [{ lv: 1, name: "ã¿ãªã‚‰ã„å†’é™ºå®¶" }, { lv: 2, name: "ã‹ã‘ã ã—ã®æ—…äºº" }, { lv: 3, name: "ã„ã£ã±ã—ã®æˆ¦å£«" }, { lv: 4, name: "ãƒ™ãƒ†ãƒ©ãƒ³æ¢ç´¢è€…" }];
        const gachaItems = [{ id: 1, emoji: "ğŸ¸" }, { id: 2, emoji: "ğŸª™" }, { id: 3, emoji: "ğŸ—¡ï¸" }, { id: 4, emoji: "ğŸ¦…" }, { id: 5, emoji: "ğŸ‰" }, { id: 6, emoji: "ğŸ‘‘" }, { id: 7, emoji: "ğŸ’" }, { id: 8, emoji: "ğŸ¦„" }];

        function updateStatus() {
            document.getElementById("disp-level").innerText = level;
            document.getElementById("disp-exp").innerText = exp;
            document.getElementById("disp-coin").innerText = coin;
            let currentTitle = titles[0].name;
            for(let i=0; i<titles.length; i++){ if(level >= titles[i].lv) currentTitle = titles[i].name; }
            document.getElementById("disp-title").innerText = "ï¼ˆ" + currentTitle + "ï¼‰";
            localStorage.setItem('saved_level', level); localStorage.setItem('saved_exp', exp); localStorage.setItem('saved_coin', coin); localStorage.setItem('saved_collection', JSON.stringify(myCollectionIds));
        }

        // --- UIæ“ä½œ ---
        function toggleMenu(menuId) {
            playSound('click');
            // ä¸€åº¦ã™ã¹ã¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
            document.querySelectorAll('.sub-menu').forEach(menu => {
                if(menu.id !== menuId) menu.classList.add('hidden');
            });
            // å¯¾è±¡ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹é–‰ã™ã‚‹
            document.getElementById(menuId).classList.toggle('hidden');
        }

        // ã‚¯ã‚¨ã‚¹ãƒˆã¸ç§»å‹•ï¼ˆURLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å­¦å¹´ã¨ãƒ¢ãƒ¼ãƒ‰ã‚’æ¸¡ã™ï¼‰
        function goToQuest(url) {
            playSound('click');
            setTimeout(() => { window.location.href = url; }, 150);
        }

        function playGacha() {
            if (coin < 10) { document.getElementById("gacha-message").innerText = "ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã‚ˆï¼"; document.getElementById("gacha-message").style.color = "#d32f2f"; return; }
            playSound('gacha'); coin -= 10;
            let item = gachaItems[Math.floor(Math.random() * gachaItems.length)];
            document.getElementById("gacha-result-emoji").innerText = item.emoji;
            document.getElementById("gacha-message").innerText = "ãŠå®ã‚²ãƒƒãƒˆï¼"; document.getElementById("gacha-message").style.color = "#2e7d32";
            if (!myCollectionIds.includes(item.id)) myCollectionIds.push(item.id);
            updateStatus(); updateCollectionGrid();
        }

        function updateCollectionGrid() {
            let grid = document.getElementById("collection-grid"); grid.innerHTML = "";
            gachaItems.forEach(item => {
                let div = document.createElement("div"); div.className = "collection-item";
                if (myCollectionIds.includes(item.id)) div.innerText = item.emoji; else div.innerHTML = "<span class='collection-unknown'>ï¼Ÿ</span>";
                grid.appendChild(div);
            });
        }

        updateStatus(); updateCollectionGrid();
    </script>
</body>
</html>
