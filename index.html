<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†’é™ºã®æ‹ ç‚¹ - ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ</title>
    <style>
        /* ===================================
           å…¨ä½“ãƒ‡ã‚¶ã‚¤ãƒ³
        ==================================== */
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #e8f5e9; color: #333; margin: 0; padding-bottom: 50px; text-align: center; }
        
        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .app-title { color: #2e7d32; font-size: 2rem; margin: 15px 0; text-shadow: 2px 2px 0px #fff; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆãƒ¬ãƒ™ãƒ«ãƒ»ç§°å·ï¼‰ */
        .status-bar { background-color: #3e2723; color: #fff; padding: 15px; display: flex; justify-content: space-around; font-size: 1.2rem; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.3); border-radius: 10px; margin: 0 10px; }
        .title-text { color: #ffd54f; font-size: 0.9em; margin-left: 5px; }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆãƒœã‚¿ãƒ³ã‚„ãƒãƒ¼ãƒˆã‚’å›²ã‚€æ ï¼‰ */
        #main-content { margin: 20px auto; max-width: 650px; padding: 0 10px; }
        
        button { font-weight: bold; padding: 12px 18px; margin: 8px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 5px 0 rgba(0,0,0,0.2); transition: transform 0.1s; }
        button:active { transform: translateY(5px); box-shadow: 0 0 0 rgba(0,0,0,0); }
        
        /* 1. ã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒªã‚¢ */
        .quest-section { background-color: #fff8e1; padding: 20px; border-radius: 10px; border: 4px solid #8d6e63; margin-bottom: 30px; }
        .quest-btn { background-color: #4caf50; color: white; font-size: 1.2rem; width: 90%; padding: 15px; margin: 10px auto; display: block; }
        
        /* 2. ã‚¬ãƒãƒ£ã‚¨ãƒªã‚¢ */
        .gacha-section { background-color: #fce4ec; padding: 20px; border-radius: 10px; border: 4px dashed #f06292; margin-bottom: 30px; }
        .btn-gacha-play { background-color: #e53935; color: white; font-size: 1.3rem; padding: 15px 30px; }
        .gacha-display-area { font-size: 4rem; margin: 10px 0; min-height: 80px; }
        .gacha-name { font-size: 1.2rem; font-weight: bold; color: #d84315; }

        /* 3. å†’é™ºãƒãƒ¼ãƒˆï¼ˆå›³é‘‘ï¼‰ã‚¨ãƒªã‚¢ */
        .adventure-note { 
            background-color: #fff3e0; 
            padding: 20px; 
            border-radius: 5px 15px 15px 5px; /* å³å´ãŒä¸¸ã„æœ¬ã®ã‚ˆã†ãªå½¢ */
            border-left: 15px solid #795548; /* æœ¬ã®èƒŒè¡¨ç´™ */
            border-top: 2px solid #8d6e63;
            border-right: 2px solid #8d6e63;
            border-bottom: 2px solid #8d6e63;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
        }
        .note-title { color: #5d4037; border-bottom: 2px dotted #8d6e63; padding-bottom: 10px; margin-top: 0; }
        .collection-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .collection-item { font-size: 2.5rem; background: #fff; border: 1px solid #d7ccc8; border-radius: 5px; padding: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
        .collection-unknown { color: #e0e0e0; font-size: 2rem; display: flex; align-items: center; justify-content: center; height: 100%; }

        .message-area { font-size: 1.2em; font-weight: bold; margin-top: 10px; min-height: 1.5em; }
    </style>
</head>
<body>

    <h1 class="app-title">âš”ï¸ ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ âš”ï¸</h1>

    <header id="status-bar" class="status-bar">
        <div>ğŸŒŸ Lv: <span id="disp-level">1</span> <span id="disp-title" class="title-text">ï¼ˆã¿ãªã‚‰ã„ï¼‰</span></div>
        <div>âš”ï¸ EXP: <span id="disp-exp">0</span>/5</div>
        <div>ğŸª™ <span id="disp-coin">10</span>æš</div>
    </header>

    <main id="main-content">

        <section class="quest-section">
            <h2 style="color: #3e2723; margin-top: 0;">ğŸ—ºï¸ ã©ã“ã¸ ã¼ã†ã‘ã‚“ã« ã§ã‚‹ï¼Ÿ</h2>
            <button class="quest-btn" onclick="goToQuest('unit1.html')">ğŸŒ² unit 1: ãŸã—ã–ã‚“ã®æ£® (1ğŸª™)</button>
            <button class="quest-btn" onclick="goToQuest('unit2.html')" style="background-color: #689f38;">â›°ï¸ unit 2: ã²ãã–ã‚“ã®å±± (2ğŸª™)</button>
            <button class="quest-btn" onclick="goToQuest('unit3.html')" style="background-color: #ef6c00;">ğŸŒ‹ unit 3: ã‹ã‘ã–ã‚“ã®ç«å±± (3ğŸª™)</button>
            <button class="quest-btn" onclick="goToQuest('unit4.html')" style="background-color: #0277bd;">ğŸŒŠ unit 4: ãƒŸãƒƒã‚¯ã‚¹ã®æµ· (5ğŸª™)</button>
        </section>

        <section class="gacha-section">
            <h2 style="margin-top: 0; color: #c2185b;">ğŸ ãŠå®ã‚¬ãƒãƒ£</h2>
            <div class="gacha-display-area">
                <div id="gacha-result-emoji" class="gacha-emoji">â“</div>
            </div>
            <div id="gacha-result-name" class="gacha-name">ãªã«ãŒã§ã‚‹ã‹ãªï¼Ÿ</div>
            <button class="btn-gacha-play" onclick="playGacha()">ã‚¬ãƒãƒ£ã‚’ã¾ã‚ã™ï¼ˆ10ğŸª™ï¼‰</button>
            <div id="gacha-message" class="message-area"></div>
        </section>

        <section class="adventure-note">
            <h2 class="note-title">ğŸ“” ã¼ã†ã‘ã‚“ãƒãƒ¼ãƒˆ</h2>
            <p style="font-size: 0.9rem; color: #757575;">ã‚ã¤ã‚ãŸ ãŠå®ã‚„ ç”Ÿãç‰©ãŸã¡ãŒ ãã‚ãã•ã‚Œã‚‹ãï¼</p>
            <div id="collection-grid" class="collection-grid"></div>
        </section>

    </main>

    <script>
        // --- ãƒ–ãƒ©ã‚¦ã‚¶ã®éŸ³ã‚·ã‚¹ãƒ†ãƒ  ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            
            if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'gacha') {
                osc.type = 'square'; osc.frequency.setValueAtTime(440, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(880, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            }
        }

        // --- ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ ---
        let level = parseInt(localStorage.getItem('saved_level')) || 1;
        let exp = parseInt(localStorage.getItem('saved_exp')) || 0;
        let coin = parseInt(localStorage.getItem('saved_coin')) || 10;
        let myCollectionIds = JSON.parse(localStorage.getItem('saved_collection')) || [];

        // ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ
        const titles = [{ lv: 1, name: "ã¿ãªã‚‰ã„å†’é™ºå®¶" }, { lv: 2, name: "ã‹ã‘ã ã—ã®æ—…äºº" }, { lv: 3, name: "ã„ã£ã±ã—ã®æˆ¦å£«" }, { lv: 4, name: "ãƒ™ãƒ†ãƒ©ãƒ³æ¢ç´¢è€…" }, { lv: 5, name: "ä¼èª¬ã®å‹‡è€…" }];
        const gachaItems = [
            { id: 1, emoji: "ğŸ¸", name: "ã‚¹ãƒ©ã‚¤ãƒ ã‚¬ã‚¨ãƒ«" }, { id: 2, emoji: "ğŸª™", name: "å¤ã³ãŸé‡‘è²¨" },
            { id: 3, emoji: "ğŸ—¡ï¸", name: "ã©ã†ã®ã¤ã‚‹ã" }, { id: 4, emoji: "ğŸ¦…", name: "å¤§ç©ºã®ãƒ¯ã‚·" }, { id: 5, emoji: "ğŸ‰", name: "ä¼èª¬ã®ãƒ‰ãƒ©ã‚´ãƒ³" }
        ];

        // --- ç”»é¢æ›´æ–°ã¨ã‚»ãƒ¼ãƒ– ---
        function updateAndSaveStatus() {
            document.getElementById("disp-level").innerText = level;
            document.getElementById("disp-exp").innerText = exp;
            document.getElementById("disp-coin").innerText = coin;

            let currentTitle = titles[0].name;
            for(let i=0; i<titles.length; i++){ if(level >= titles[i].lv) currentTitle = titles[i].name; }
            document.getElementById("disp-title").innerText = "ï¼ˆ" + currentTitle + "ï¼‰";

            localStorage.setItem('saved_level', level);
            localStorage.setItem('saved_exp', exp);
            localStorage.setItem('saved_coin', coin);
            localStorage.setItem('saved_collection', JSON.stringify(myCollectionIds));
        }

        // --- ã‚¯ã‚¨ã‚¹ãƒˆã¸å‡ºç™º ---
        function goToQuest(url) {
            playSound('click');
            setTimeout(() => { window.location.href = url; }, 150);
        }

        // --- ã‚¬ãƒãƒ£æ©Ÿèƒ½ ---
        function playGacha() {
            if (coin < 10) {
                playSound('wrong');
                document.getElementById("gacha-message").innerText = "ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã‚ˆï¼";
                document.getElementById("gacha-message").style.color = "#d32f2f";
                return;
            }

            playSound('gacha');
            coin -= 10;
            
            let randomIdx = Math.floor(Math.random() * gachaItems.length);
            let item = gachaItems[randomIdx];

            document.getElementById("gacha-result-emoji").innerText = item.emoji;
            document.getElementById("gacha-result-name").innerText = item.name;
            document.getElementById("gacha-message").innerText = "ã€Œ" + item.name + "ã€ã‚’ã‚²ãƒƒãƒˆã—ãŸï¼";
            document.getElementById("gacha-message").style.color = "#2e7d32";

            if (!myCollectionIds.includes(item.id)) {
                myCollectionIds.push(item.id);
            }
            
            updateAndSaveStatus();
            updateCollectionGrid(); // å¼•ã„ãŸã‚‰ã™ãå›³é‘‘ã«åæ˜ 
        }

        // --- å†’é™ºãƒãƒ¼ãƒˆï¼ˆå›³é‘‘ï¼‰ã®è¡¨ç¤ºæ›´æ–° ---
        function updateCollectionGrid() {
            let grid = document.getElementById("collection-grid");
            grid.innerHTML = "";
            gachaItems.forEach(item => {
                let div = document.createElement("div");
                div.className = "collection-item";
                if (myCollectionIds.includes(item.id)) { 
                    div.innerText = item.emoji; 
                } else { 
                    div.innerHTML = "<span class='collection-unknown'>ï¼Ÿ</span>"; 
                }
                grid.appendChild(div);
            });
        }

        // èµ·å‹•æ™‚å‡¦ç†
        updateAndSaveStatus();
        updateCollectionGrid(); // ç”»é¢ã‚’é–‹ã„ãŸç¬é–“ã«å›³é‘‘ã‚’æç”»
    </script>
</body>
</html>
